<!-- Navbar Component -->
<nav class="navbar" [class.scrolled]="isScrolled">
  <div class="navbar-container">


    <!-- Logo -->
    <a routerLink="/" class="logo" aria-label="DocManager Home">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="logo-icon">
        <path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" fill="currentColor" fill-opacity="0.1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M8 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>DocManager</span>
    </a>

    <!-- Search Bar -->
    <div class="search-container" *ngIf="!(isMenuOpen)">
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
          <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search documents..." 
          [(ngModel)]="searchQuery"
          (input)="onSearch($event)"
          (keyup.enter)="performSearch()"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()"
        />
        <button 
          *ngIf="searchQuery" 
          class="clear-search" 
          (click)="clearSearch()"
          type="button"
          aria-label="Clear search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
            <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile menu button -->
    <button 
      class="mobile-menu-button" 
      [class.active]="isMenuOpen"
      (click)="toggleMenu()" 
      type="button"
      [attr.aria-expanded]="isMenuOpen"
      [attr.aria-controls]="'primary-navigation'"
      aria-label="Toggle navigation menu">
      <span class="menu-icon"></span>
    </button>
    
    <!-- Navigation Links -->
    <ul class="nav-menu" 
        [class.active]="isMenuOpen"
        id="primary-navigation"
        role="menubar"
        aria-label="Main navigation">
  
      <!-- Debug Info (remove in production) -->
      <div *ngIf="false" style="display: none;">
        isLoggedIn$: {{ isLoggedIn$ | async | json }}
        currentRole: {{ currentRole | json }}
        isClerkRoute: {{ isClerkRoute() | json }}
        router.url: {{ router.url }}
      </div>





        <!-- Home Link -->
      <li class="nav-item" role="none">
        <a [routerLink]="['/']" 
           routerLinkActive="active" 
           class="nav-link"
           role="menuitem"
           (click)="closeMenu(); $event.stopPropagation()">
          <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ 'Home' | translate }}</span>
        </a>
      </li>
      
      <!-- Dashboard Link for all logged-in users -->
      <li class="nav-item" role="none" *ngIf="(isLoggedIn$ | async)">
        <a [routerLink]="getDashboardRoute()" 
           routerLinkActive="active" 
           class="nav-link"
           role="menuitem"
           (click)="closeMenu(); $event.stopPropagation()">
          <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 11L12 3L21 11V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 22V15H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 8V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ 'Dashboard' | translate }}</span>
        </a>
      </li>
      
      <!-- Documents Link -->
      <li class="nav-item" role="none" *ngIf="isLoggedIn$ | async">
        <a [routerLink]="['/documents']" 
           routerLinkActive="active" 
           class="nav-link"
           role="menuitem"
           (click)="closeMenu(); $event.stopPropagation()">
          <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ 'Documents' | translate }}</span>
        </a>
      </li>
      
      <!-- Department Link -->
      <li class="nav-item" role="none" *ngIf="isLoggedIn$ | async">
        <a [routerLink]="['/department']" 
           routerLinkActive="active" 
           class="nav-link"
           role="menuitem"
           (click)="closeMenu(); $event.stopPropagation()">
          <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
          </svg>
          <span>{{ 'Department' | translate }}</span>
        </a>
      </li>
      
      <li class="nav-item" role="none">
        <a [routerLink]="['/about']" 
           routerLinkActive="active" 
           class="nav-link"
           role="menuitem"
           (click)="closeMenu(); $event.stopPropagation()">
          <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ 'About' | translate }}</span>
        </a>
      </li>
      <li class="nav-item" role="none">
        <a [routerLink]="['/contact']" 
           routerLinkActive="active" 
           class="nav-link"
           role="menuitem"
           (click)="closeMenu(); $event.stopPropagation()">
          <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 16.92V21a2 2 0 0 1-2.18 2 19.91 19.91 0 0 1-8.63-3.07 19.76 19.76 0 0 1-6.32-6.32A19.91 19.91 0 0 1 3 5.18 2 2 0 0 1 5 3h2.5a2 2 0 0 1 2 1.72l.46 3.43a2 2 0 0 1-.59 1.82L7.91 11.41a16 16 0 0 0 6.68 6.68l1.44-1.46a2 2 0 0 1 1.82-.59l3.43.46A2 2 0 0 1 22 16.92Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ 'Contact' | translate }}</span>
        </a>
      </li>
      
      <!-- Login/User Menu -->
      <li class="nav-item" role="none">
        <ng-container *ngIf="!(isLoggedIn$ | async); else userMenu">
          <a [routerLink]="['/login']" 
             class="nav-link login-button"
             role="menuitem"
             (click)="closeMenu(); $event.stopPropagation()">
            <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10 17L15 12L10 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M15 12H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{{ 'Login' | translate }}</span>
          </a>
        </ng-container>
        
        <ng-template #userMenu>
          <div class="user-menu">
            <button class="nav-link user-button" (click)="toggleUserMenu(); $event.stopPropagation()" [attr.aria-expanded]="isUserMenuOpen" aria-controls="user-dropdown">
              <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{{ 'Profile' | translate }}</span>
              <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="dropdown-menu" [class.show]="isUserMenuOpen" id="user-dropdown">
              <a routerLink="/profile" class="dropdown-item" (click)="closeMenu(); isUserMenuOpen = false; $event.stopPropagation()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>{{ 'Profile' | translate }}</span>
              </a>
              <button (click)="logout(); closeMenu(); isUserMenuOpen = false; $event.stopPropagation()" class="dropdown-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>{{ 'Logout' | translate }}</span>
              </button>
            </div>
          </div>
        </ng-template>
      </li>
    </ul>
  </div>
</nav>
