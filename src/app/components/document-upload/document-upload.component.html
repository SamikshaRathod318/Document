<div class="document-upload-container" [class.dragover]="isDragging" (click)="onFileInputClick()" tabindex="0" (keydown.enter)="onFileInputClick()">
  <input 
    #fileInput
    type="file"
    class="file-input"
    (change)="onFileSelected($event)"
    [accept]="acceptedFileTypes.join(',')"
    multiple
    aria-label="Select files to upload"
    tabindex="-1"
  >
  
  <div class="upload-area" *ngIf="!uploadedFiles.length">
    <div class="upload-icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 3V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h3>Drag & Drop your files here</h3>
    <p>or click to browse files</p>
    <p class="file-types">Supported formats: {{ acceptedFileTypes.join(', ') }}</p>
    <p class="file-size">Max file size: {{ maxFileSize / (1024 * 1024) }}MB</p>
  </div>

  <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" class="upload-form" *ngIf="uploadedFiles.length">
    <div class="form-group">
      <label for="category">Category <span class="required">*</span></label>
      <input 
        id="category" 
        type="text" 
        formControlName="category" 
        placeholder="e.g., Contracts, Invoices, Reports"
        aria-required="true"
      >
      <div class="error" *ngIf="uploadForm.get('category')?.touched && uploadForm.get('category')?.errors?.['required']">
        Category is required
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description <span class="required">*</span></label>
      <textarea 
        id="description" 
        formControlName="description" 
        rows="3"
        placeholder="Add a brief description of the document(s)"
        aria-required="true"
      ></textarea>
      <div class="error" *ngIf="uploadForm.get('description')?.touched && uploadForm.get('description')?.errors?.['required']">
        Description is required
      </div>
      <div class="char-count">
        {{ uploadForm.get('description')?.value?.length || 0 }}/500
      </div>
    </div>

    <div class="file-list">
      <div class="file-item" *ngFor="let fileInfo of uploadedFiles; let i = index" [class.error]="fileInfo.status === 'error'">
        <div class="file-icon">
          {{ getFileIcon(fileInfo.file.name) }}
        </div>
        <div class="file-info">
          <div class="file-name" [title]="fileInfo.file.name">{{ fileInfo.file.name }}</div>
          <div class="file-meta">
            <span class="file-size">{{ getFileSize(fileInfo.file.size) }}</span>
            <span class="file-status" [class.error]="fileInfo.status === 'error'">
              <span *ngIf="fileInfo.status === 'pending'">Waiting to upload...</span>
              <span *ngIf="fileInfo.status === 'uploading'">Uploading... {{ fileInfo.progress }}%</span>
              <span *ngIf="fileInfo.status === 'completed'">Upload complete</span>
              <span *ngIf="fileInfo.status === 'error'" [title]="fileInfo.error">{{ fileInfo.error || 'Upload failed' }}</span>
            </span>
          </div>
          <div class="progress-bar" *ngIf="fileInfo.status === 'uploading'">
            <div class="progress" [style.width.%]="fileInfo.progress"></div>
          </div>
        </div>
        <div class="file-actions">
          <button 
            *ngIf="fileInfo.status === 'error'" 
            type="button" 
            class="btn-icon" 
            (click)="$event.stopPropagation(); retryUpload(i)"
            aria-label="Retry upload"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M23 4V10H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 20V14H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3.51 9C4.01717 7.56678 4.87913 6.2854 6.01547 5.27542C7.1518 4.26543 8.52547 3.55976 10.0083 3.22426C11.4911 2.88875 13.0348 2.93434 14.4952 3.35677C15.9556 3.77921 17.2853 4.56471 18.36 5.64L23 10M1 14L5.64 18.36C6.71475 19.4353 8.04437 20.2208 9.50481 20.6432C10.9652 21.0657 12.5089 21.1112 13.9917 20.7757C15.4745 20.4402 16.8482 19.7346 17.9845 18.7246C19.1209 17.7146 19.9828 16.4332 20.49 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button 
            type="button" 
            class="btn-icon danger" 
            (click)="$event.stopPropagation(); cancelUpload(i)"
            [disabled]="fileInfo.status === 'completed'"
            aria-label="Cancel upload"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button 
        type="button" 
        class="btn secondary" 
        (click)="onFileInputClick()"
        [disabled]="isUploading()"
      >
        Add More Files
      </button>
      <button 
        type="submit" 
        class="btn primary"
        [disabled]="!uploadForm.valid || uploadedFiles.length === 0 || isUploading()"
      >
        Upload {{ uploadedFiles.length }} File{{ uploadedFiles.length !== 1 ? 's' : '' }}
      </button>
    </div>
  </form>
</div>
